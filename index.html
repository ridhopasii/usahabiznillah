<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Usu Polmed Servis | Solusi Teknis Mahasiswa USU & Polmed</title>
    <!-- Muat Tailwind CSS --><script src="https://cdn.tailwindcss.com"></script>
    <!-- Konfigurasi Font (Inter) --><style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7;
        }
        .icon-svg {
            fill: none;
            stroke: currentColor;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }
        /* Style untuk Floating WhatsApp Button */
        .floating-whatsapp {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            background-color: #25D366; 
            color: white;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.25);
            transition: all 0.3s ease;
        }
        .floating-whatsapp:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 15px rgba(0,0,0,0.35);
        }
        .floating-whatsapp svg {
            fill: white;
            stroke: none;
            width: 30px;
            height: 30px;
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- Navbar --><header class="bg-white shadow-md sticky top-0 z-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo Dwiwarna (Usu Hijau, Polmed Ungu) --><a href="#" class="text-2xl font-bold tracking-tight">
                    <span class="text-green-700">Usu</span> 
                    <span class="text-purple-700">Polmed</span>
                    <span class="text-gray-900"> Servis</span>
                </a>

                <!-- Nav Desktop --><nav class="hidden md:flex space-x-8">
                    <a href="#layanan" class="text-gray-600 hover:text-green-700 transition duration-150 font-medium">Layanan Kami</a>
                    <a href="#jualbeli" class="text-gray-600 hover:text-green-700 transition duration-150 font-medium">Laptop Second</a>
                    <a href="#testimoni" class="text-gray-600 hover:text-green-700 transition duration-150 font-medium">Testimoni</a>
                    <a href="#kontak" class="text-gray-600 hover:text-green-700 transition duration-150 font-medium">Kontak</a>
                </nav>

                <!-- Mobile Menu Button --><button id="menu-button" class="md:hidden p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-green-500">
                    <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                    </svg>
                </button>
            </div>
        </div>
        <!-- Mobile Menu (Hidden by default) --><div id="mobile-menu" class="hidden md:hidden bg-white border-t border-gray-100">
            <div class="pt-2 pb-3 space-y-1 px-2 sm:px-3">
                <a href="#layanan" class="block rounded-md p-2 text-base font-medium text-gray-700 hover:bg-green-50 hover:text-green-700">Layanan Kami</a>
                <a href="#jualbeli" class="block rounded-md p-2 text-base font-medium text-gray-700 hover:bg-green-50 hover:text-green-700">Laptop Second</a>
                <a href="#testimoni" class="block rounded-md p-2 text-base font-medium text-gray-700 hover:bg-green-50 hover:text-green-700">Testimoni</a>
                <a href="#kontak" class="block rounded-md p-2 text-base font-medium text-gray-700 hover:bg-green-50 hover:text-green-700">Kontak</a>
            </div>
        </div>
    </header>
    
    <!-- Management/Admin Panel (Hidden by default) --><section class="py-10 bg-gray-200 hidden" id="admin-panel">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <h2 class="text-2xl font-extrabold text-gray-900 mb-6 border-b-2 border-green-500 pb-2">
                Manajemen Produk (Admin)
            </h2>
            <div id="admin-status" class="mb-4 p-3 rounded-lg text-sm bg-green-100 text-green-800">
                Akses Admin Aktif. Silakan isi form di bawah untuk menambahkan laptop baru.
            </div>

            <!-- Form Tambah Laptop --><form id="add-laptop-form" class="bg-white p-6 rounded-xl shadow-lg">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="nama" class="block text-sm font-medium text-gray-700">Nama/Model Laptop</label>
                        <input type="text" id="nama" name="nama" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500 p-2 border">
                    </div>
                    <div>
                        <label for="harga" class="block text-sm font-medium text-gray-700">Harga (Contoh: 5200000)</label>
                        <input type="number" id="harga" name="harga" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500 p-2 border">
                    </div>
                </div>
                <div class="mt-4">
                    <label for="deskripsi" class="block text-sm font-medium text-gray-700">Deskripsi Singkat</label>
                    <input type="text" id="deskripsi" name="deskripsi" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500 p-2 border">
                </div>
                <!-- Input FILE -->
                <div class="mt-4">
                    <label for="imageFile" class="block text-sm font-medium text-gray-700">Upload Gambar Laptop (.jpg/.png) - Max 1MB (Disimpan di Storage)</label>
                    <input type="file" id="imageFile" name="imageFile" accept="image/png, image/jpeg" class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-green-50 file:text-green-700 hover:file:bg-green-100">
                </div>
                <button type="submit" class="mt-6 w-full py-2 px-4 border border-transparent rounded-xl shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition duration-150">
                    Tambah Laptop ke Stok
                </button>
            </form>
            
            <button id="toggle-admin-btn" class="mt-4 text-xs text-gray-500 hover:text-green-600">
                Sembunyikan Panel Admin
            </button>
        </div>
    </section>

    <!-- Services Section (MOVED TO TOP) --><section class="py-16 sm:py-24 bg-white" id="layanan">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-16">
                <h2 class="text-3xl font-extrabold text-gray-900 sm:text-4xl">
                    Layanan Andal untuk Kebutuhan Akademik Anda
                </h2>
                <p class="mt-4 text-xl text-gray-500">
                    Kami mengerti betapa pentingnya perangkat Anda untuk kuliah. Layanan kami fokus pada kecepatan dan kualitas.
                </p>
            </div>

            <!-- Services Grid --><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10">

                <!-- Service 1: Perbaikan Software --><div class="bg-gray-50 p-6 rounded-xl shadow-xl border-t-4 border-green-500 hover:shadow-2xl transition duration-300 transform hover:-translate-y-1">
                    <div class="text-green-600 mb-4 inline-block">
                        <svg class="h-10 w-10 icon-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20h9"/><path d="M16.5 13.5l-3 3-1.5-1.5 3-3"/><path d="M18 10l-4-4"/></svg>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900 mb-2">
                        Perbaikan Software & Data
                    </h3>
                    <p class="text-gray-600 mb-4 text-sm">
                        Instalasi ulang OS, membersihkan virus bandel, hingga penyelamatan data tugas akhir yang hilang.
                    </p>
                    <ul class="text-sm text-gray-500 list-disc list-inside space-y-1">
                        <li>Instalasi Windows/macOS/Linux</li>
                        <li>Pembersihan Virus & Malware</li>
                        <li>Recovery Data Penting</li>
                        <li>Setting Program Kuliah (AutoCAD, SPSS, dll.)</li>
                    </ul>
                </div>
                
                <!-- Service 2: Perbaikan Hardware --><div class="bg-gray-50 p-6 rounded-xl shadow-xl border-t-4 border-green-500 hover:shadow-2xl transition duration-300 transform hover:-translate-y-1">
                    <div class="text-green-600 mb-4 inline-block">
                        <svg class="h-10 w-10 icon-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14 17l-1 4"/><rect width="20" height="12" x="2" y="5" rx="2" ry="2"/><path d="M2 17h20"/></svg>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900 mb-2">
                        Perbaikan Hardware & Upgrade
                    </h3>
                    <p class="text-gray-600 mb-4 text-sm">
                        Mengatasi masalah fisik, *overheating*, ganti komponen rusak, dan meningkatkan performa perangkat Anda.
                    </p>
                    <ul class="text-sm text-gray-500 list-disc list-inside space-y-1">
                        <li>Ganti Layar, Baterai, Keyboard</li>
                        <li>Upgrade RAM/SSD Cepat</li>
                        <li>Perbaikan Mati Total / Short Circuit</li>
                        <li>Pembersihan dan Ganti Thermal Paste</li>
                    </ul>
                </div>

                <!-- Service 3: Servis Printer --><div class="bg-gray-50 p-6 rounded-xl shadow-xl border-t-4 border-green-500 hover:shadow-2xl transition duration-300 transform hover:-translate-y-1">
                    <div class="text-green-600 mb-4 inline-block">
                        <svg class="h-10 w-10 icon-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><path d="M18 10V6a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v4"/><path d="M12 14v7"/></svg>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900 mb-2">
                        Servis Printer Kampus
                    </h3>
                    <p class="text-gray-600 mb-4 text-sm">
                        Layanan lengkap untuk printer, agar tugas dan makalah Anda tercetak sempurna tanpa hambatan.
                    </p>
                    <ul class="text-sm text-gray-500 list-disc list-inside space-y-1">
                        <li>Perbaikan Head dan Mainboard Printer</li>
                        <li>Mengatasi Tinta Macet / Hasil Buram</li>
                        <li>Refill Tinta dan Pasang Sistem Infus</li>
                        <li>Servis Printer Dot Matrix/Laser/Inkjet</li>
                    </ul>
                </div>
            </div>

            <!-- CTA to Contact --><div class="mt-16 text-center">
                <a href="https://wa.me/6289699453507" target="_blank" class="inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-bold rounded-xl shadow-lg text-white bg-green-600 hover:bg-green-700 transition duration-300 transform hover:scale-105">
                    <span class="mr-2">üîß</span> Konsultasi Masalah Perangkat Gratis via WhatsApp
                </a>
            </div>
        </div>
    </section>

    <!-- Hero Section --><section class="bg-green-700 py-16 sm:py-24" id="home">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <h1 class="text-4xl sm:text-5xl lg:text-6xl font-extrabold text-white leading-tight mb-4">
                Layanan Teknis Terpercaya Pilihan Mahasiswa USU & Polmed
            </h1>
            <p class="text-xl sm:text-2xl text-green-200 mb-8 max-w-3xl mx-auto">
                Fokus studi Anda, biar urusan perangkat kami yang tangani. Cepat, Bergaransi, Harga Mahasiswa!
            </p>
            <a href="#jualbeli" class="inline-flex items-center justify-center px-8 py-3 border border-transparent text-base font-bold rounded-xl shadow-lg text-green-700 bg-white hover:bg-green-50 transition duration-300 transform hover:scale-105">
                Cek Stok Laptop Second Terbaru
            </a>
        </div>
    </section>

    <!-- Why Choose Us Section --><section class="py-16 sm:py-24 bg-gray-50" id="keunggulan">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-16">
                <h2 class="text-3xl font-extrabold text-gray-900 sm:text-4xl">
                    Jaminan Kualitas Layanan Kami
                </h2>
                <p class="mt-4 text-xl text-gray-500">
                    Kami fokus melayani Anda yang butuh solusi cepat tanpa menguras kantong.
                </p>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8 text-center">
                <!-- Feature 1 --><div class="p-6 bg-white rounded-xl shadow-md">
                    <div class="text-4xl mb-3 text-green-500">üí∏</div>
                    <h3 class="font-bold text-lg mb-1">Harga Mahasiswa</h3>
                    <p class="text-gray-600 text-sm">Tarif jasa dan harga jual beli yang bersahabat di kantong pelajar.</p>
                </div>
                <!-- Feature 2 --><div class="p-6 bg-white rounded-xl shadow-md">
                    <div class="text-4xl mb-3 text-yellow-500">‚ö°</div>
                    <h3 class="font-bold text-lg mb-1">Pengerjaan Cepat</h3>
                    <p class="text-gray-600 text-sm">Prioritas perbaikan agar Anda bisa segera lanjut mengerjakan tugas.</p>
                </div>
                <!-- Feature 3 --><div class="p-6 bg-white rounded-xl shadow-md">
                    <div class="text-4xl mb-3 text-purple-500">‚úÖ</div>
                    <h3 class="font-bold text-lg mb-1">Garansi Resmi</h3>
                    <p class="text-gray-600 text-sm">Semua perbaikan dan unit second dilengkapi garansi purna jual.</p>
                </div>
                <!-- Feature 4 --><div class="p-6 bg-white rounded-xl shadow-md">
                    <div class="text-4xl mb-3 text-red-500">üìç</div>
                    <h3 class="font-bold text-lg mb-1">Dekat Kampus</h3>
                    <p class="text-gray-600 text-sm">Lokasi strategis, mudah diakses dari area USU dan Polmed.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Testimonials Section --><section class="py-16 sm:py-24 bg-white" id="testimoni">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-16">
                <h2 class="text-3xl font-extrabold text-gray-900 sm:text-4xl">
                    Apa Kata Mereka yang Sudah Servis?
                </h2>
                <p class="mt-4 text-xl text-gray-500">
                    Ulasan nyata dari Mahasiswa USU dan Polmed yang telah menggunakan jasa kami.
                </p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <!-- Testimonial 1 --><div class="p-6 bg-purple-50 rounded-xl border-l-4 border-purple-500 hover:shadow-lg transition duration-300">
                    <p class="italic text-gray-700 mb-4">"Laptopku mati total karena tumpahan kopi, tapi di sini bisa dibenerin dalam 2 hari! Harganya masuk akal banget buat kantong anak kos. Recommended!"</p>
                    <p class="font-bold text-gray-900">Risa Anjani</p>
                    <p class="text-sm text-purple-600">Mahasiswa Fasilkom-TI, USU</p>
                </div>
                
                <!-- Testimonial 2 --><div class="p-6 bg-purple-50 rounded-xl border-l-4 border-purple-500 hover:shadow-lg transition duration-300">
                    <p class="italic text-gray-700 mb-4">"Beli laptop second di sini, unitnya mulus dan sudah terinstal semua program desain yang aku butuhin. Garansi sebulan bikin tenang. Mantap!"</p>
                    <p class="font-bold text-gray-900">Bagus Permana</p>
                    <p class="text-sm text-purple-600">Mahasiswa Jurusan Teknik Sipil, Polmed</p>
                </div>
                
                <!-- Testimonial 3 --><div class="p-6 bg-purple-50 rounded-xl border-l-4 border-purple-500 hover:shadow-lg transition duration-300">
                    <p class="italic text-gray-700 mb-4">"Printerku macet pas mau *deadline* laporan. Langsung dibawa ke sini, sorenya sudah kelar. Pelayanan ramah dan profesional. Nilai plus!"</p>
                    <p class="font-bold text-gray-900">Citra Dewi</p>
                    <p class="text-sm text-purple-600">Mahasiswa FEB, USU</p>
                </div>
            </div>
        </div>
    </section>


    <!-- Used Laptop Offerings Section --><section class="py-16 sm:py-24 bg-gray-100" id="jualbeli">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center mb-16">
                 <div class="text-left">
                    <h2 class="text-3xl font-extrabold text-gray-900 sm:text-4xl">
                        Unit Laptop Second Pilihan
                    </h2>
                    <p class="mt-2 text-xl text-gray-500">
                        Stok real-time! Lihat unit terbaik yang sedang tersedia untuk kebutuhan kuliah.
                    </p>
                </div>
                <!-- Tombol Admin -->
                <button id="show-admin-btn" class="px-4 py-2 bg-purple-600 text-white rounded-xl shadow-md hover:bg-purple-700 transition duration-150 text-sm font-medium">
                    + Tambah Produk (Admin)
                </button>
            </div>

            <!-- Laptop Card Grid (Content will be injected here from Firestore) --><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8" id="laptop-list-container">
                <p class="text-center col-span-full text-gray-500" id="loading-message">Memuat data laptop...</p>
                <!-- Dynamic cards will be placed here --></div>
            
            <div class="mt-12 text-center">
                <p class="text-gray-500 italic">Stok unit diperbarui secara otomatis dari database.</p>
            </div>
        </div>
    </section>

    <!-- Contact Section --><section class="py-16 sm:py-24 bg-purple-700" id="kontak">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-white text-center">
            <h2 class="text-3xl font-extrabold sm:text-4xl mb-6">
                Hubungi Kami: Jangan Biarkan Tugas Anda Tertunda!
            </h2>
            <p class="text-xl text-purple-200 mb-10">
                Layanan tersedia 6 hari seminggu. Kami siap membantu Anda segera.
            </p>
            
            <div class="flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-6 mb-12">
                
                <!-- CTA 1: WhatsApp --><a href="https://wa.me/6289699453507" target="_blank" class="inline-flex items-center justify-center px-8 py-4 border border-transparent text-base font-bold rounded-xl shadow-lg text-purple-700 bg-white hover:bg-purple-50 transition duration-300 transform hover:scale-105">
                    <svg class="h-6 w-6 mr-2 icon-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 14.54 14.54 0 0 1-5.65 6.59 23.95 23.95 0 0 1-4.7 0 14.54 14.54 0 0 1-5.65-6.59A8.38 8.38 0 0 1 3 11.5c0-4.66 3.55-8.48 8-9.35l-1.5 1.5"/></svg>
                    WhatsApp (0896-9945-3507)
                </a>

                <!-- CTA 2: Jam Operasional --><div class="inline-flex items-center justify-center px-8 py-4 border border-white text-base font-bold rounded-xl shadow-lg text-white bg-transparent">
                    <svg class="h-6 w-6 mr-2 icon-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
                    Buka: Sen-Sab (09:00 - 18:00 WIB)
                </div>
            </div>
            
            <p class="text-sm text-purple-300">
                Alamat Fisik: Jl. Pintu 4 USU, dekat Gerbang Utama Polmed, Medan.
            </p>

        </div>
    </section>

    <!-- Footer --><footer class="bg-gray-900 text-white py-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <div class="mb-4">
                <!-- Logo Dwiwarna Footer --><a href="#" class="text-xl font-bold tracking-tight">
                    <span class="text-green-400">Usu</span> 
                    <span class="text-purple-400">Polmed</span>
                    <span class="text-white"> Servis</span>
                </a>
            </div>
            <div class="text-sm text-gray-400 space-x-4">
                <a href="#layanan" class="hover:text-green-400 transition">Layanan</a>
                <span class="text-gray-600">|</span>
                <a href="#jualbeli" class="hover:text-green-400 transition">Laptop Second</a>
                <span class="text-gray-600">|</span>
                <a href="#kontak" class="hover:text-green-400 transition">Hubungi</a>
            </div>
            <p class="mt-4 text-xs text-gray-500">
                &copy; 2024 Usu Polmed Servis. Solusi Teknis Mahasiswa.
            </p>
        </div>
    </footer>

    <!-- Floating WhatsApp Button (Selalu Tampil) -->
    <a href="https://wa.me/6289699453507?text=Halo%20Usu%20Polmed%20Servis,%20saya%20ingin%20bertanya%20tentang..." class="floating-whatsapp" target="_blank">
        <!-- Ikon WhatsApp (SVG) -->
        <svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
            <path d="M12.04 2.34c-5.33 0-9.67 4.34-9.67 9.67s4.34 9.67 9.67 9.67 9.67-4.34 9.67-9.67-4.34-9.67-9.67-9.67zm.05 15.68c-1.42 0-2.82-.47-4.04-1.39l-.29-.17-3.05.79.8-.25c-.24-.44-.45-.92-.61-1.42l-.18-.54c-1.04-1.6-1.59-3.41-1.59-5.27.01-4.14 3.37-7.51 7.51-7.51 2.01 0 3.92.78 5.35 2.21 1.43 1.43 2.22 3.34 2.22 5.35 0 4.14-3.37 7.51-7.51 7.51zm3.83-5.21c-.2-.09-.9-.44-1.04-.49-.14-.05-.24-.07-.34.07-.1.14-.38.49-.46.59-.08.1-.16.12-.29.05-.14-.07-.6-.22-1.13-.7-.42-.39-.71-.7-1.01-1.22-.29-.49-.03-.45.06-.56.09-.1.2-.24.29-.36.09-.09.12-.17.18-.29.06-.11.03-.22-.02-.31-.05-.09-.45-1.07-.62-1.47-.16-.39-.32-.34-.46-.34-.14 0-.3.01-.46.01-.16 0-.41.06-.62.29-.2.22-.76.74-.76 1.81 0 1.07.78 2.09.89 2.25.1.16 1.51 2.31 3.61 3.23 1.95.83 2.33.74 2.76.69.43-.05 1.42-.58 1.63-1.15.21-.57.21-1.05.15-1.15-.06-.1-.2-.15-.42-.26z"/>
        </svg>
    </a>

    <!-- Firebase SDK & Logic --><script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, getDoc, doc, deleteDoc, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-storage.js";

        // Global variables for Firebase (MANDATORY USE)
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null; 

        // Admin State and Password
        let isAdmin = false;
        const ADMIN_PASSWORD = "Bismillah24**"; 
        const MAX_FILE_SIZE_MB = 1; 

        let app, db, auth, storage;
        let userId = 'anon';

        // Helper function for user messages
        function displayMessage(message, color) {
            const statusDiv = document.getElementById('admin-status');
            statusDiv.textContent = message;
            statusDiv.className = `mb-4 p-3 rounded-lg text-sm bg-${color}-100 text-${color}-800`;
        }
        
        // Function to toggle Admin Panel visibility and buttons
        function toggleAdminPanel(show) {
            const panel = document.getElementById('admin-panel');
            const button = document.getElementById('show-admin-btn');
            if (!panel) return;

            if (show) {
                panel.classList.remove('hidden');
                panel.classList.add('active-admin');
                button.textContent = 'Sembunyikan Produk (Admin)';
                document.querySelectorAll('.delete-btn').forEach(btn => btn.classList.remove('hidden'));
            } else {
                panel.classList.add('hidden');
                panel.classList.remove('active-admin');
                button.textContent = '+ Tambah Produk (Admin)';
                document.querySelectorAll('.delete-btn').forEach(btn => btn.classList.add('hidden'));
            }
        }

        async function initFirebase() {
            try {
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                storage = getStorage(app); 

                if (initialAuthToken) { 
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }

                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userId = user.uid;
                        setupProductListener();
                    } else {
                        userId = 'anon-' + crypto.randomUUID(); 
                        setupProductListener();
                    }
                });

            } catch (error) {
                console.error("Error initializing Firebase:", error);
                document.getElementById('loading-message').textContent = 'Gagal memuat data: Koneksi database bermasalah.';
            }
        }

        // Function to render the list of laptops
        function renderLaptops(laptops) {
            const container = document.getElementById('laptop-list-container');
            container.innerHTML = ''; 

            if (laptops.length === 0) {
                container.innerHTML = '<p class="text-center col-span-full text-gray-500">Saat ini tidak ada unit laptop second yang tersedia. Silakan cek lagi nanti!</p>';
                return;
            }

            const isAdminActive = document.getElementById('admin-panel')?.classList.contains('active-admin');

            laptops.forEach(laptop => {
                const formatter = new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 });
                const priceFormatted = formatter.format(laptop.harga);
                const defaultImage = "https://placehold.co/600x400/16a34a/ffffff?text=Usu+Polmed+Servis+Laptop"; 
                const imageSrc = laptop.imageUrl || defaultImage; 

                const cardHtml = `
                    <div class="bg-white rounded-xl shadow-lg overflow-hidden border border-gray-100">
                        <img src="${imageSrc}" alt="Gambar Laptop: ${laptop.nama}" class="w-full h-48 object-cover" onerror="this.onerror=null;this.src='${defaultImage}';">
                        <div class="p-6">
                            <h3 class="text-xl font-bold text-gray-900 mb-1">${laptop.nama}</h3>
                            <p class="text-sm text-gray-500 mb-3">${laptop.deskripsi}</p>
                            <span class="text-2xl font-extrabold text-green-600 block mb-4">${priceFormatted}</span>
                            <a href="https://wa.me/6289699453507?text=Halo,%20saya%20tertarik%20dengan%20laptop%20${encodeURIComponent(laptop.nama)}%20yang%20ada%20di%20website." target="_blank" class="block w-full text-center py-2 rounded-lg bg-green-500 text-white font-medium hover:bg-green-600 transition">
                                Tanyakan Stok (WhatsApp)
                            </a>
                            <button data-id="${laptop.id}" class="delete-btn mt-2 w-full text-center py-1 rounded-lg text-xs text-red-500 hover:text-red-700 ${isAdminActive ? '' : 'hidden'}">Hapus</button>
                        </div>
                    </div>
                `;
                container.insertAdjacentHTML('beforeend', cardHtml);
            });
            
            if (isAdminActive) {
                document.querySelectorAll('.delete-btn').forEach(button => {
                    button.addEventListener('click', handleDelete);
                });
            }
        }

        // 3. Listener to fetch and update data in real-time
        function setupProductListener() {
            const laptopsCollectionPath = `artifacts/${appId}/public/data/laptops`;
            const q = collection(db, laptopsCollectionPath);
            
            onSnapshot(q, (snapshot) => {
                const laptops = [];
                snapshot.forEach((doc) => {
                    laptops.push({ id: doc.id, ...doc.data() });
                });
                renderLaptops(laptops);
                const loadingMessage = document.getElementById('loading-message');
                if (loadingMessage) {
                    loadingMessage.classList.add('hidden');
                }
            }, (error) => {
                console.error("Error listening to laptops data:", error);
                document.getElementById('loading-message').textContent = 'Error memuat data: Gagal sinkronisasi.';
            });
        }
        
        // 4. Submission Handler for Admin Form
        document.getElementById('add-laptop-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            if (!isAdmin || !db || !storage) {
                displayMessage('Akses ditolak, database, atau Storage belum siap.', 'red');
                return;
            }
            
            const fileInput = document.getElementById('imageFile');
            const file = fileInput.files[0];
            let downloadURL = '';
            
            const formData = new FormData(e.target);
            const laptopName = formData.get('nama');
            
            try {
                if (file) {
                    if (file.size > MAX_FILE_SIZE_MB * 1024 * 1024) {
                         displayMessage(`Ukuran file melebihi batas ${MAX_FILE_SIZE_MB}MB. Gunakan gambar yang lebih kecil.`, 'red');
                         return;
                    }
                    
                    displayMessage(`Mengunggah gambar ${file.name}...`, 'yellow');

                    // 1. Upload File ke Firebase Storage
                    const storageRef = ref(storage, `laptops/${Date.now()}_${file.name}`);
                    const uploadTask = await uploadBytes(storageRef, file);
                    
                    // 2. Dapatkan URL publik
                    downloadURL = await getDownloadURL(uploadTask.ref);
                    
                    displayMessage(`Gambar berhasil diunggah. Menyimpan data ke Firestore...`, 'yellow');
                }
                
                // 3. Buat objek data baru
                 let newLaptop = {
                    nama: laptopName,
                    harga: parseInt(formData.get('harga'), 10),
                    deskripsi: formData.get('deskripsi'),
                    imageUrl: downloadURL, // Menyimpan URL Storage
                    createdAt: new Date()
                };

                // 4. Simpan ke Firestore
                const laptopsCollectionPath = `artifacts/${appId}/public/data/laptops`;
                await addDoc(collection(db, laptopsCollectionPath), newLaptop);
                displayMessage(`Laptop '${newLaptop.nama}' berhasil ditambahkan!`, 'green');
                e.target.reset(); // Clear the form
            } catch (error) {
                console.error("Error adding document or uploading image:", error);
                displayMessage(`Gagal: ${error.message || 'Cek konsol untuk detail error.'}`, 'red');
            }
        });

        // 5. Delete Handler (Admin only)
        async function handleDelete(e) {
            const laptopId = e.target.dataset.id;
            
            if (!isAdmin) {
                displayMessage('Akses ditolak. Anda bukan admin.', 'red');
                return;
            }

            try {
                const docPath = `artifacts/${appId}/public/data/laptops/${laptopId}`;
                const docRef = doc(db, docPath);

                await deleteDoc(docRef);
                displayMessage(`Laptop ID ${laptopId} berhasil dihapus.`, 'orange');
            } catch (error) {
                console.error("Error deleting document:", error);
                displayMessage('Gagal menghapus laptop.', 'red');
            }
        }


        // Toggle Admin Panel with Password Check
        document.getElementById('show-admin-btn').addEventListener('click', () => {
            const panel = document.getElementById('admin-panel');
            
            if (!isAdmin) {
                const passwordAttempt = prompt("Masukkan password admin untuk membuka panel:");
                if (passwordAttempt === ADMIN_PASSWORD) {
                    isAdmin = true;
                    toggleAdminPanel(true);
                    displayMessage("Akses Admin berhasil dibuka. Anda sekarang bisa menambah/menghapus produk.", 'green');
                } else if (passwordAttempt !== null) {
                    displayMessage("Password salah. Akses ditolak.", 'red');
                }
            } else {
                toggleAdminPanel(panel.classList.contains('hidden'));
            }
        });
        
        // Hide Admin Panel button handler
        document.getElementById('toggle-admin-btn').addEventListener('click', () => {
             toggleAdminPanel(false);
        });


        // Initialize Firebase on load
        initFirebase();
    </script>

    <!-- JavaScript for Mobile Menu --><script>
        document.addEventListener('DOMContentLoaded', () => {
            const menuButton = document.getElementById('menu-button');
            const mobileMenu = document.getElementById('mobile-menu');

            function toggleMenu() {
                mobileMenu.classList.toggle('hidden');
            }

            menuButton.addEventListener('click', toggleMenu);

            const mobileLinks = mobileMenu.querySelectorAll('a');
            mobileLinks.forEach(link => {
                link.addEventListener('click', () => {
                    if (!mobileMenu.classList.contains('hidden')) {
                         toggleMenu();
                    }
                });
            });
        });
    </script>
</body>
</html>
